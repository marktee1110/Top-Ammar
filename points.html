<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>ğŸ—ºï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ù‚Ø§Ø· - Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø¹Ù…Ø§Ø± ÙŠÙˆØ³Ù</title>
  <style>
    :root{--main:#0ea5e9;--danger:#ef4444}
    body{font-family:system-ui;background:#f8fafc;color:#0f172a;margin:0}
    header{background:var(--main);color:#fff;padding:16px;text-align:center;font-size:20px;font-weight:700}
    nav{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
      padding:10px;
      background:#fff;
      border-bottom:1px solid #e6e6e6;
    }
    nav button{
      background:#fff;
      border:1px solid transparent;
      padding:6px 10px;
      border-radius:6px;
      cursor:pointer;
      font-size:14px;
      color:#64748b;
    }
    nav button.active{
      color:var(--main);
      font-weight:700;
      background:rgba(14,165,233,0.06);
      border-color:rgba(14,165,233,0.12);
    }
    .card{background:#fff;padding:14px;margin:20px;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
    input{padding:8px;margin:4px;border:1px solid #cbd5e1;border-radius:6px}
    button{padding:8px 12px;margin:4px;border:none;border-radius:6px;cursor:pointer}
    .btn-main{background:#0ea5e9;color:#fff}
    .btn-danger{background:#ef4444;color:#fff}
    .btn-edit{background:#f59e0b;color:#fff}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{
      border:1px solid #e2e8f0;
      padding:10px;
      text-align:center;
      font-size:16px;
      font-weight:600;
      color:#0b122a;
    }
    th{background:#e2e8f0}
    tbody tr:nth-child(even){background:#f1f5f9}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
<header>ğŸ—ºï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ù‚Ø§Ø· - Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø¹Ù…Ø§Ø± ÙŠÙˆØ³Ù</header>

<nav>
  <button onclick="location.href='index.html'">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  <button onclick="location.href='sessions.html'">ğŸ—‚ï¸ Ø§Ù„Ø¬Ù„Ø³Ø§Øª</button>
  <button onclick="location.href='search.html'">ğŸ” Ø§Ù„Ø¨Ø­Ø«</button>
</nav>

<div class="card">
  <h2>Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
  <input id="point_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù†Ù‚Ø·Ø©">
  <input id="point_x" type="number" placeholder="X (Ø£Ø¯Ø®Ù„ Ù…ÙˆØ¬Ø¨Ø©)">
  <input id="point_y" type="number" placeholder="Y">
  <button class="btn-main" onclick="addPoint()">â• Ø¥Ø¶Ø§ÙØ©</button>
</div>

<div class="card">
  <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ù‚Ø§Ø·</h2>
  <button class="btn-edit" onclick="toggleControls()">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·</button>
  <table id="table_db">
    <thead>
      <tr><th>#</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>X</th><th>Y</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <br>
  <button onclick="exportExcel()" class="btn-main">ğŸ“Š ØªØµØ¯ÙŠØ± Excel</button>
  <button onclick="confirmImport()" class="btn-main">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel</button>
  <input type="file" id="importExcel" accept=".xlsx" style="display:none" onchange="importExcel()" />
</div>
</body>
</html>

<script>
// Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø©
let sessionsDB = JSON.parse(localStorage.getItem("sessionsDB") || "[]");
// Ù†Ø­Ø¯Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ù…Ø«Ù„Ø§Ù‹ Ø£ÙˆÙ„ Ø¬Ù„Ø³Ø©)
let currentSessionId = sessionsDB.length ? sessionsDB[0].id : null;
let pointsDB = currentSessionId 
  ? (sessionsDB.find(s=>s.id===currentSessionId)?.points || [])
  : [];

let showControls = false;

function saveDB(){
  if(currentSessionId){
    let s = sessionsDB.find(s=>s.id===currentSessionId);
    if(s){
      s.points = pointsDB;
      localStorage.setItem("sessionsDB", JSON.stringify(sessionsDB));
    }
  }
}

function addPoint(){
  const name=document.getElementById("point_name").value.trim();
  const x=parseFloat(document.getElementById("point_x").value);
  const y=parseFloat(document.getElementById("point_y").value);
  if(!name||isNaN(x)||isNaN(y)){ alert("âš ï¸ Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©"); return; }
  pointsDB.push({name, x:-Math.abs(x), y:y}); // Ù†Ø®Ø²Ù† X Ø³Ø§Ù„Ø¨Ø©
  saveDB();
  renderDBTable();
  clearInputs();
}

function deletePoint(i){
  pointsDB.splice(i,1);
  saveDB();
  renderDBTable();
}

function editPoint(i){
  const p=pointsDB[i];
  const name=prompt("Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯:",p.name);
  const x=parseFloat(prompt("X Ø¬Ø¯ÙŠØ¯:",Math.abs(p.x))); // Ù†Ø¹Ø±Ø¶ Ù…ÙˆØ¬Ø¨Ø©
  const y=parseFloat(prompt("Y Ø¬Ø¯ÙŠØ¯:",p.y));
  if(!name||isNaN(x)||isNaN(y)){ alert("âš ï¸ Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©"); return; }
  if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ØŸ")){
    pointsDB[i]={name, x:-Math.abs(x), y:y}; // Ù†Ø®Ø²Ù† Ø³Ø§Ù„Ø¨Ø©
    saveDB();
    renderDBTable();
  }
}

function renderDBTable(){
  const tbody=document.querySelector("#table_db tbody");
  const thead=document.querySelector("#table_db thead tr");
  tbody.innerHTML="";
  thead.innerHTML = showControls
    ? "<th>#</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>X</th><th>Y</th><th>ØªØ­ÙƒÙ…</th>"
    : "<th>#</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>X</th><th>Y</th>";
  pointsDB.forEach((p,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML = showControls
      ? `<td>${i+1}</td><td>${p.name}</td><td>${p.x}</td><td>${p.y}</td>
         <td>
           <button class="btn-edit" onclick="editPoint(${i})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
           <button class="btn-danger" onclick="deletePoint(${i})">ğŸ—‘ Ø­Ø°Ù</button>
         </td>`
      : `<td>${i+1}</td><td>${p.name}</td><td>${p.x}</td><td>${p.y}</td>`;
    tbody.appendChild(tr);
  });
}

function clearInputs(){
  document.getElementById("point_name").value="";
  document.getElementById("point_x").value="";
  document.getElementById("point_y").value="";
}

/* ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel */
function exportExcel(){
  if(!pointsDB.length){ alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ù‚Ø§Ø·"); return; }
  const ws = XLSX.utils.json_to_sheet(pointsDB);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Points");
  XLSX.writeFile(wb, "points.xlsx");
}

/* ØªØ£ÙƒÙŠØ¯ Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ */
function confirmImport(){
  const msg = "âš ï¸ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ù„Ù Excel Ø¨Ù†ÙØ³ ØµÙŠØºØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„:\n\n" +
              "Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©: # | Ø§Ù„Ø§Ø³Ù… | X | Y\n\n" +
              "Ù…Ø«Ø§Ù„:\n" +
              "1 | Ù†Ù‚Ø·Ø©1 | -123.45 | 456.78\n" +
              "2 | Ù†Ù‚Ø·Ø©2 | -200.00 | 300.00\n\n" +
              "Ù‡Ù„ ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù‡Ø°Ù‡ Ø§Ù„ØµÙŠØºØ© Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ØŸ";
  if(confirm(msg)){
    document.getElementById("importExcel").click();
  } else {
    alert("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯");
  }
}

/* Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Excel */
function importExcel(){
  const file = document.getElementById("importExcel").files[0];
  if(!file){ return; }
  const reader = new FileReader();
  reader.onload = function(e){
    const data = new Uint8Array(e.target.result);
    const wb = XLSX.read(data, {type:"array"});
    const ws = wb.Sheets[wb.SheetNames[0]];
    const imported = XLSX.utils.sheet_to_json(ws);
    imported.forEach(p=>{
      if(p.name && !isNaN(p.x) && !isNaN(p.y)){
        pointsDB.push({name:p.name, x:-Math.abs(parseFloat(p.x)), y:parseFloat(p.y)});
      }
    });
    saveDB();
    renderDBTable();
    alert("âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨Ù†Ø¬Ø§Ø­");
  };
  reader.readAsArrayBuffer(file);
}

function toggleControls(){
  showControls=!showControls;
  renderDBTable();
}

document.addEventListener("DOMContentLoaded",renderDBTable);
</script>
</body>
</html>